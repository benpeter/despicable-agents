# Margo Review -- Replace Session ID File with SessionStart Hook

VERDICT: APPROVE

## Summary

This change replaces a shared-file session ID mechanism (`/tmp/claude-session-id`) with a per-session environment variable set via a `SessionStart` hook. The change is proportional to the problem: one race condition eliminated, one hook added, nine references updated mechanically, two downstream files cleaned up. No new abstractions, no new dependencies, no speculative features.

## Complexity Assessment

- **New abstractions**: 0
- **New dependencies**: 0 (jq was already required)
- **New files**: 0
- **Lines added/removed**: Net negative (each two-line SID-read-then-write pattern collapsed to a single-line env var reference)
- **Complexity budget spend**: ~0. The hook is a one-liner shell command in YAML frontmatter. It replaces a more complex mechanism (shared file read) with a simpler one (env var).

## File-by-File

### skills/nefario/SKILL.md

The hook command (line 14) is correct and minimal. The `INPUT=$(cat)` pattern prevents broken pipe. The `jq -r ".session_id // empty"` safely handles missing fields. The guards (`[ -n "$SID" ] && [ -n "$CLAUDE_ENV_FILE" ]`) prevent writing garbage. The `>>` append avoids clobbering other hooks. All 9 downstream references correctly use `$CLAUDE_SESSION_ID` with no intermediate variable.

### .claude/skills/despicable-statusline/SKILL.md

The `[ -n "$sid" ] && echo "$sid" > /tmp/claude-session-id;` fragment was removed from State A's command (line 45). The `$sid` extraction and nefario status file reading remain intact. States B and D were correctly left untouched (they never contained the write). Clean removal.

### docs/using-nefario.md

The "How It Works" paragraph (line 197) now accurately describes the hook mechanism and adds the concurrent-session note. The manual config JSON example (lines 204-211) no longer contains the shared-file write. Both changes are factual updates, not scope expansion.

## Findings

- [NIT] skills/nefario/SKILL.md:14 -- The `tr -dc "[:alnum:]-_"` sanitization in the hook command was not in the synthesis plan. Session IDs are generated by Claude Code (not user input), so this guards against a non-existent attack vector. Harmless but technically unnecessary. Not blocking -- the cost is one pipe stage in a hook that fires a few times per session.
  AGENT: devx-minion
  FIX: Could remove `| tr -dc "[:alnum:]-_"` to match the plan exactly, but keeping it is fine.

## Verdict Reasoning

The change passes all checks:
- **YAGNI**: No speculative features. Solves exactly the stated problem (race condition in concurrent sessions).
- **KISS**: Simpler mechanism (env var vs. shared file read). Fewer moving parts. Each status write is now one line instead of two.
- **Scope alignment**: Three files changed, all directly related to the task. No adjacent features, no future-proofing, no technology expansion.
- **Dependency count**: Unchanged. No new tools or libraries.
- **Proportionality**: Small problem, small fix. The complexity budget spend is effectively zero.
